---
title: "PCA_Revised_Bacteria_Proportions"
author: "Cassandra Sperow"
date: "2023-10-04"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## 

# Principal Components Analysis for Revised Bacteria Proportions 

- Read in revised data of proportions per bacteria per sample: 
```{r}
read_csv("../output/rev_bacteria_prop_df.csv") -> rev_bacteria_prop_df
```


```{r}
# take out sample_id column and scale proportions data
stats::prcomp(rev_bacteria_prop_df[,-1], scale. = T) -> pca_out
```

- Fixed::::For this error and from this discussion online, there seems to be a column with an Inf when scaling is applied because of the tandard deviation. It would be a column that has all constant values to where the standard deviation would be 0 and the variance would be 0.

```{r}
map(rev_bacteria_prop_df, ~sd(.)) %>% as.data.frame() %>% 
  pivot_longer(cols = everything()) %>% 
  filter(value==0)
```

- Why are these columns returning 0 standard deviation?
```{r}
rev_bacteria_prop_df$ASV10000 %>% sum()

# compare with original column in counts data frame
read_csv("../output/rev_bacteria.csv") -> rev_bacteria

rev_bacteria$ASV10000 %>% sum() # this proportion must have been calculated as 0
rev_bacteria$ASV10000 # when we look at the original column, the counts are so low that the proportion would be 0 when the low counts were divided by the row sums

# Example:  Row sum of first sample: 
rev_bacteria[1,-1] %>% sum()
# counts for this sample across the row
rev_bacteria[1,-1] 
# proportions across this row
(rev_bacteria[1,-1]  )/(rev_bacteria[1,-1] %>% sum())



```
- Comparing the low count of __ for ASV0075 will give a 0.000 proportion when rounding to 3 decimal places. 
- Even for  ASV0057 and ASV0078 with 25 and 68 in counts, respectively, will give  0.0002488503 and 0.0006768728 in proportions rowwise, respectively. 
- Since the data frame is full of low counts for several bacteria, we can either increase the number of rounded decimal places when calculating the proportions, or figure out criteria for taking these ASVs out. I do not think it's recommended to do the PCA without scaling. 

```{r}
```


```{r}
#stats::prcomp(rev_bacteria_prop_df[,-1]) -> pca_out_ns
```


```{r}
summary(pca_out) -> summary_pca

summary_pca$importance %>% as.data.frame()
```

```{r}
plot(pca_out)
```


```{r}

factoextra::fviz_pca_var(pca_out, 
             #col.var = "steelblue", 
             col.var = "contrib", 
             gradient.cols = c("red", "blue", "green"), 
            # repel = T, 
            label = "none",
             title = "All Variables in PCA")
```


```{r}
```


```{r}
```


```{r}
```
